services:
  portainer:
    image: {{ portainer_server_image }}
    container_name: portainer
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - {{ app_base_dir }}/portainer_data:/data
    networks:
      - public_net
    ports:
      # SEGURIDAD: Bind SOLO a la IP de Tailscale (VPN)
      # No exponer a 0.0.0.0
      - "{{ tailscale_ip }}:9000:9000"
      - "{{ tailscale_ip }}:9443:9443"
      - "{{ tailscale_ip }}:8000:8000"
    labels:
      com.docker.stack.namespace: "management"
    resources:
      limits:
        cpus: "2.0"
        memory: "2G"
      reservations:
        cpus: "1.0"
        memory: "1G"
  public_net:
    external: true